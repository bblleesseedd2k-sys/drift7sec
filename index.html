<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Drift Countdown Animation</title>
<!-- üîπ –ü–æ–¥–∫–ª—é—á–∞–µ–º —à—Ä–∏—Ñ—Ç -->
<link href="https://fonts.googleapis.com/css?family=Kdam+Thmor&display=swap" rel="stylesheet">
<style>
  html, body {
    height: 100%;
    width: 100%;
    margin: 0;
    background: #000;
    display: flex;
    justify-content: center;
    align-items: center;
    overflow: hidden;
    font-family: "Kdam Thmor", system-ui, sans-serif;
  }
  /* –û—Å–Ω–æ–≤–Ω–æ–π –±–ª–æ–∫ */
  #captureZone {
    position: relative;
    width: 1280px;
    height: 720px;
    background: url("background.jpg") center/cover no-repeat;
    transform-origin: top center;
  }
  /* –ú–∞—Å—à—Ç–∞–± –ø–æ–¥ —ç–∫—Ä–∞–Ω */
  @media (min-aspect-ratio: 16/9) {
    #captureZone { transform: scale(calc(100vh / 720)); }
  }
  @media (max-aspect-ratio: 16/9) {
    #captureZone { transform: scale(calc(100vw / 1280)); }
  }
  .warning-area {
    position: absolute;
    top: 100px; 
    left: 50%;
    transform: translateX(-50%);
    width: 800px; 
    text-align: center;
    color: white;
  }
  .warning-area h1 {
    color: #e64a4a;
    font-size: 58px;
    margin: 0 0 10px 0;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
  }
  .warning-area .sub {
    font-size: 40px;
    margin: 0 0 20px 0;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
  }
  .timer {
    font-size: 80px;
    font-weight: 700;
    color: #e64a4a;
    text-shadow: 3px 3px 6px rgba(0,0,0,0.9);
    letter-spacing: 8px;
  }
  .phone {
    position: absolute;
    top: 441px; 
    left: 50%;
    transform: translateX(-50%);
    font-size: 28px; 
    font-weight: 600;
    color: #000;
    letter-spacing: 2px;
    background: rgba(255,255,255,0.95);
    padding: 15px 40px;
    border-radius: 50px;
  }
  .amounts {
    position: absolute;
    top: 540px;
    left: 50%;
    transform: translateX(-50%);
    font-size: 26px;
    font-weight: 600;
    color: white;
    text-align: center;
    white-space: nowrap;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
  }
  .username {
    position: absolute;
    bottom: 30px; 
    left: 62px;
    color: #ccc;
    font-size: 20px;
    text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
  }
  /* –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è */
  .controls {
    position: fixed;
    bottom: 10px; right: 10px;
    background: rgba(0,0,0,0.8);
    color: #fff;
    padding: 12px 16px;
    border-radius: 10px;
    font-size: 14px;
    z-index: 20;
    max-width: 300px;
  }
  .controls label { display: block; margin-top: 6px; }
  .controls input {
    width: 100%; 
    padding: 6px 8px; 
    margin-top: 2px;
    border-radius: 4px; 
    border: none;
    box-sizing: border-box;
  }
  .controls button {
    margin-top: 10px; 
    background: #e64a4a; 
    color: #fff; 
    border: none;
    padding: 10px 12px; 
    border-radius: 6px; 
    cursor: pointer; 
    font-weight: 600;
    width: 100%;
  }
  .controls button:disabled {
    background: #666;
    cursor: not-allowed;
  }
  
  /* Canvas –¥–ª—è –∑–∞–ø–∏—Å–∏ - —Å–∫—Ä—ã—Ç */
  #renderCanvas {
    display: none;
  }
  
  /* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ */
  #progress {
    display: none;
    margin-top: 10px;
    padding: 8px;
    background: rgba(0,0,0,0.9);
    border-radius: 6px;
    font-size: 12px;
  }
  #progressBar {
    width: 100%;
    height: 8px;
    background: #333;
    border-radius: 4px;
    overflow: hidden;
    margin-top: 6px;
  }
  #progressFill {
    height: 100%;
    background: #e64a4a;
    width: 0%;
    transition: width 0.3s;
  }
  
  .note {
    margin-top: 8px;
    padding: 6px;
    background: rgba(230, 74, 74, 0.2);
    border-radius: 4px;
    font-size: 10px;
    line-height: 1.3;
  }
</style>
</head>
<body>
  <div id="captureZone">
    <div class="warning-area">
      <h1>WARNING</h1>
      <div class="sub">PROFIT WILL BE CANCELLED IN</div>
      <div class="timer" id="timer">12:00:00</div>
    </div>
    <div class="phone" id="phone">01145852502</div>
    <div class="amounts">
      THE AMOUNT TO BE PAID IS <span id="amount1">24,899</span> EGP<br>
      TO THE CONCLUSION: <span id="amount2">248,099.08</span> EGP
    </div>
    <div class="username" id="username">Yara Mohamed</div>
  </div>
  
  <div class="controls" id="controls">
    <label>‚è± –í—Ä–µ–º—è (HH:MM:SS): <input id="inputTimer" type="text" value="12:00:00"></label>
    <label>üìû –ù–æ–º–µ—Ä: <input id="inputPhone" type="text" value="01145852502"></label>
    <label>üí∞ –ü–ª–∞—Ç—ë–∂: <input id="inputAmt1" type="text" value="24,899"></label>
    <label>üìà –ü—Ä–∏–±—ã–ª—å: <input id="inputAmt2" type="text" value="248,099.08"></label>
    <label>üë§ –ò–º—è: <input id="inputName" type="text" value="Yara Mohamed"></label>
    <label>üé¨ –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (—Å–µ–∫): <input id="inputDuration" type="number" value="7" min="1" max="60"></label>
    <button onclick="applyData()">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
    <button onclick="startCountdown()">‚ñ∂ Start</button>
    <button id="recordBtn" onclick="recordVideo()">üé• MP4 –¥–ª—è Telegram</button>
    
    <div id="progress">
      <div id="progressText">–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞...</div>
      <div id="progressBar"><div id="progressFill"></div></div>
    </div>
    
    <div class="note">
      üí° –í–∏–¥–µ–æ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ MP4 (H.264) –¥–ª—è Telegram
    </div>
  </div>
  
  <canvas id="renderCanvas"></canvas>
  
  <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ -->
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <script type="module">
    import { FFmpeg } from 'https://unpkg.com/@ffmpeg/ffmpeg@0.12.7/dist/esm/index.js';
    import { fetchFile, toBlobURL } from 'https://unpkg.com/@ffmpeg/util@0.12.1/dist/esm/index.js';
    
    window.FFmpeg = FFmpeg;
    window.fetchFile = fetchFile;
    window.toBlobURL = toBlobURL;
    window.ffmpegReady = true;
  </script>
  
  <script>
  let countdown = 0;
  let timerInterval = null;
  let ffmpeg = null;
  
  function pad(n){return n.toString().padStart(2,"0");}
  
  function fmt(s){
    if(s<0) s=0;
    const h=Math.floor(s/3600);
    const m=Math.floor((s%3600)/60);
    const sec=s%60;
    return `${pad(h)}:${pad(m)}:${pad(sec)}`;
  }
  
  function parseHMS(str){
    const parts=str.trim().split(":");
    if(parts.length!==3) return null;
    const[h,m,s]=parts.map(Number);
    if([h,m,s].some(n=>isNaN(n)||n<0)) return null;
    return h*3600+m*60+s;
  }
  
  function updateTimer(){
    document.getElementById("timer").textContent=fmt(countdown);
  }
  
  function startCountdown(limitSeconds=null){
    clearInterval(timerInterval);
    const total=parseHMS(document.getElementById("inputTimer").value);
    if(total===null){
      alert("–í–≤–µ–¥–∏—Ç–µ –≤—Ä–µ–º—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ HH:MM:SS");
      return;
    }
    countdown=total;
    updateTimer();
    let ticks=0;
    timerInterval=setInterval(()=>{
      countdown--;
      updateTimer();
      if(limitSeconds!==null){
        ticks++;
        if(ticks>=limitSeconds) clearInterval(timerInterval);
      }
    },1000);
  }
  
  function applyData(){
    document.getElementById("phone").textContent=document.getElementById("inputPhone").value;
    document.getElementById("amount1").textContent=document.getElementById("inputAmt1").value;
    document.getElementById("amount2").textContent=document.getElementById("inputAmt2").value;
    document.getElementById("username").textContent=document.getElementById("inputName").value;
    const val=document.getElementById("inputTimer").value.trim();
    const s=parseHMS(val);
    document.getElementById("timer").textContent=s!==null?fmt(s):val;
  }
  
  document.addEventListener("DOMContentLoaded",()=>{
    document.getElementById("inputTimer").addEventListener("input",applyData);
  });
  
  function updateProgress(text, percent) {
    const progressDiv = document.getElementById("progress");
    const progressText = document.getElementById("progressText");
    const progressFill = document.getElementById("progressFill");
    
    progressDiv.style.display = "block";
    progressText.textContent = text;
    progressFill.style.width = percent + "%";
  }
  
  function hideProgress() {
    document.getElementById("progress").style.display = "none";
  }
  
  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è FFmpeg
  async function initFFmpeg() {
    if (ffmpeg) return ffmpeg;
    
    while (!window.ffmpegReady) {
      await new Promise(r => setTimeout(r, 100));
    }
    
    updateProgress("–ó–∞–≥—Ä—É–∑–∫–∞ FFmpeg...", 5);
    
    ffmpeg = new window.FFmpeg();
    
    ffmpeg.on("log", ({ message }) => {
      console.log(message);
    });
    
    ffmpeg.on("progress", ({ progress }) => {
      const percent = Math.round(progress * 100);
      updateProgress(`–ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è: ${percent}%`, 50 + percent / 2);
    });
    
    const baseURL = 'https://unpkg.com/@ffmpeg/core@0.12.6/dist/esm';
    
    await ffmpeg.load({
      coreURL: await window.toBlobURL(`${baseURL}/ffmpeg-core.js`, 'text/javascript'),
      wasmURL: await window.toBlobURL(`${baseURL}/ffmpeg-core.wasm`, 'application/wasm')
    });
    
    return ffmpeg;
  }
  
  async function recordVideo(){
    const recordBtn = document.getElementById("recordBtn");
    recordBtn.disabled = true;
    recordBtn.textContent = "‚è≥ –ó–∞–ø–∏—Å—ã–≤–∞—é...";
    
    let duration = parseInt(document.getElementById("inputDuration").value) || 7;
    duration = Math.min(Math.max(duration,1),60);
    const userName = (document.getElementById("inputName").value.trim().replace(/\s+/g,"_")) || "User";
    const total = parseHMS(document.getElementById("inputTimer").value);
    
    if(total===null){
      alert("–í–≤–µ–¥–∏—Ç–µ –≤—Ä–µ–º—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ HH:MM:SS");
      recordBtn.disabled = false;
      recordBtn.textContent = "üé• MP4 –¥–ª—è Telegram";
      return;
    }
    
    countdown = total;
    updateTimer();
    
    try {
      updateProgress("–°–æ–∑–¥–∞–Ω–∏–µ —Å–Ω–∏–º–∫–∞...", 10);
      
      // –°–æ–∑–¥–∞—ë–º snapshot –û–î–ò–ù –†–ê–ó
      const capture = document.getElementById("captureZone");
      const snapshot = await html2canvas(capture, {
        backgroundColor: '#000',
        useCORS: true,
        scale: 1,
        width: 1280,
        height: 720
      });
      
      // Canvas –¥–ª—è –∑–∞–ø–∏—Å–∏
      const canvas = document.getElementById("renderCanvas");
      canvas.width = 1280;
      canvas.height = 720;
      const ctx = canvas.getContext("2d", { alpha: false });
      
      updateProgress("–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∑–∞–ø–∏—Å–∏...", 15);
      
      // Stream
      const stream = canvas.captureStream(30);
      
      // –ê—É–¥–∏–æ
      const audioCtx = new AudioContext();
      const dest = audioCtx.createMediaStreamDestination();
      const osc = audioCtx.createOscillator();
      const gain = audioCtx.createGain();
      gain.gain.value = 0.001;
      osc.connect(gain).connect(dest);
      osc.start();
      
      const combinedStream = new MediaStream([
        ...stream.getVideoTracks(),
        ...dest.stream.getAudioTracks()
      ]);
      
      // Recorder
      const recorder = new MediaRecorder(combinedStream, {
        mimeType: 'video/webm;codecs=vp8,opus',
        videoBitsPerSecond: 8000000
      });
      
      const chunks = [];
      recorder.ondataavailable = e => {
        if (e.data.size > 0) chunks.push(e.data);
      };
      
      recorder.onstop = async () => {
        try {
          updateProgress("–û–±—Ä–∞–±–æ—Ç–∫–∞...", 40);
          
          const webmBlob = new Blob(chunks, {type: "video/webm"});
          
          const ffmpegInstance = await initFFmpeg();
          
          updateProgress("–ó–∞–≥—Ä—É–∑–∫–∞ –¥–ª—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏...", 45);
          await ffmpegInstance.writeFile("input.webm", await window.fetchFile(webmBlob));
          
          updateProgress("–ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ MP4...", 50);
          
          // –ö–†–ò–¢–ò–ß–ù–û: –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è Telegram
          await ffmpegInstance.exec([
            "-i", "input.webm",
            "-c:v", "libx264",
            "-profile:v", "main",        // Main profile –≤–º–µ—Å—Ç–æ baseline
            "-level", "4.0",             // –£—Ä–æ–≤–µ–Ω—å 4.0
            "-preset", "medium",
            "-crf", "20",                // –í—ã—à–µ –∫–∞—á–µ—Å—Ç–≤–æ
            "-pix_fmt", "yuv420p",
            "-vf", "scale=1280:720",     // –¢–æ—á–Ω—ã–π —Ä–∞–∑–º–µ—Ä
            "-c:a", "aac",
            "-b:a", "192k",              // –í—ã—à–µ –±–∏—Ç—Ä–µ–π—Ç –∞—É–¥–∏–æ
            "-ar", "48000",              // 48kHz –¥–ª—è –ª—É—á—à–µ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
            "-ac", "2",                  // –°—Ç–µ—Ä–µ–æ
            "-movflags", "+faststart",
            "-r", "30",
            "-max_muxing_queue_size", "1024",
            "output.mp4"
          ]);
          
          updateProgress("–ü–æ–ª—É—á–µ–Ω–∏–µ MP4...", 95);
          
          const mp4Data = await ffmpegInstance.readFile("output.mp4");
          const mp4Blob = new Blob([mp4Data.buffer], {type: "video/mp4"});
          
          await ffmpegInstance.deleteFile("input.webm");
          await ffmpegInstance.deleteFile("output.mp4");
          
          // –°–∫–∞—á–∏–≤–∞–Ω–∏–µ
          const url = URL.createObjectURL(mp4Blob);
          const a = document.createElement("a");
          a.href = url;
          a.download = `drift_${userName}_${duration}s.mp4`;
          a.click();
          URL.revokeObjectURL(url);
          
          updateProgress("‚úÖ –ì–æ—Ç–æ–≤–æ!", 100);
          setTimeout(hideProgress, 2000);
          
        } catch (error) {
          console.error("–û—à–∏–±–∫–∞:", error);
          hideProgress();
          alert("–û—à–∏–±–∫–∞: " + error.message);
        }
        
        recordBtn.disabled = false;
        recordBtn.textContent = "üé• MP4 –¥–ª—è Telegram";
        osc.stop();
        audioCtx.close();
      };
      
      // –ó–ê–ü–£–°–ö
      recorder.start(100);
      updateProgress("–ó–∞–ø–∏—Å—å –≤–∏–¥–µ–æ...", 20);
      
      startCountdown(duration);
      
      const startTime = Date.now();
      const endTime = startTime + duration * 1000;
      
      // –†–µ–Ω–¥–µ—Ä –∫–∞–¥—Ä–æ–≤
      function renderFrame() {
        const now = Date.now();
        const elapsed = now - startTime;
        
        // –ü–û–õ–ù–û–°–¢–¨–Æ –æ—á–∏—â–∞–µ–º canvas
        ctx.fillStyle = '#000';
        ctx.fillRect(0, 0, 1280, 720);
        
        // –†–∏—Å—É–µ–º snapshot
        ctx.drawImage(snapshot, 0, 0, 1280, 720);
        
        // –ü–ï–†–ï–†–ò–°–û–í–´–í–ê–ï–ú —Ç–∞–π–º–µ—Ä –ü–û–í–ï–†–•
        ctx.font = 'bold 80px "Kdam Thmor", sans-serif';
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';
        
        // –¢–µ–Ω—å –¥–ª—è —Ç–∞–π–º–µ—Ä–∞
        ctx.shadowColor = 'rgba(0, 0, 0, 0.9)';
        ctx.shadowBlur = 6;
        ctx.shadowOffsetX = 3;
        ctx.shadowOffsetY = 3;
        
        // –†–∏—Å—É–µ–º —Ç–∞–π–º–µ—Ä
        ctx.fillStyle = '#e64a4a';
        ctx.fillText(fmt(countdown), 640, 310);
        
        // –°–±—Ä–æ—Å —Ç–µ–Ω–∏
        ctx.shadowColor = 'transparent';
        ctx.shadowBlur = 0;
        ctx.shadowOffsetX = 0;
        ctx.shadowOffsetY = 0;
        
        const percent = Math.min((elapsed / (duration * 1000)) * 15, 15);
        updateProgress(`–ó–∞–ø–∏—Å—å: ${Math.round(elapsed/1000)}/${duration}—Å`, 20 + percent);
        
        if (now < endTime) {
          requestAnimationFrame(renderFrame);
        } else {
          setTimeout(() => recorder.stop(), 300);
        }
      }
      
      renderFrame();
      
    } catch (error) {
      console.error("–û—à–∏–±–∫–∞:", error);
      hideProgress();
      alert("–û—à–∏–±–∫–∞: " + error.message);
      recordBtn.disabled = false;
      recordBtn.textContent = "üé• MP4 –¥–ª—è Telegram";
    }
  }
  
  window.recordVideo = recordVideo;
  window.applyData = applyData;
  window.startCountdown = startCountdown;
  </script>
</body>
</html>
