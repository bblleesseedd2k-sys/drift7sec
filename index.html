<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Drift Countdown Animation</title>
<!-- üîπ –ü–æ–¥–∫–ª—é—á–∞–µ–º —à—Ä–∏—Ñ—Ç -->
<link href="https://fonts.googleapis.com/css?family=Kdam+Thmor&display=swap" rel="stylesheet">
<style>
  html, body {
    height: 100%;
    width: 100%;
    margin: 0;
    background: #000;
    display: flex;
    justify-content: center;
    align-items: center;
    overflow: hidden;
    font-family: "Kdam Thmor", system-ui, sans-serif;
  }
  /* –û—Å–Ω–æ–≤–Ω–æ–π –±–ª–æ–∫ */
  #captureZone {
    position: relative;
    width: 1280px;
    height: 720px;
    background: url("background.jpg") center/cover no-repeat;
    transform-origin: top center;
  }
  /* –ú–∞—Å—à—Ç–∞–± –ø–æ–¥ —ç–∫—Ä–∞–Ω */
  @media (min-aspect-ratio: 16/9) {
    #captureZone { transform: scale(calc(100vh / 720)); }
  }
  @media (max-aspect-ratio: 16/9) {
    #captureZone { transform: scale(calc(100vw / 1280)); }
  }
  .warning-area {
    position: absolute;
    top: 100px; 
    left: 50%;
    transform: translateX(-50%);
    width: 800px; 
    text-align: center;
    color: white;
  }
  .warning-area h1 {
    color: #e64a4a;
    font-size: 58px;
    margin: 0 0 10px 0;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
  }
  .warning-area .sub {
    font-size: 40px;
    margin: 0 0 20px 0;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
  }
  .timer {
    font-size: 80px;
    font-weight: 700;
    color: #e64a4a;
    text-shadow: 3px 3px 6px rgba(0,0,0,0.9);
    letter-spacing: 8px;
  }
  .phone {
    position: absolute;
    top: 441px; 
    left: 50%;
    transform: translateX(-50%);
    font-size: 28px; 
    font-weight: 600;
    color: #000;
    letter-spacing: 2px;
    background: rgba(255,255,255,0.95);
    padding: 15px 40px;
    border-radius: 50px;
  }
  .amounts {
    position: absolute;
    top: 540px;
    left: 50%;
    transform: translateX(-50%);
    font-size: 26px;
    font-weight: 600;
    color: white;
    text-align: center;
    white-space: nowrap;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
  }
  .username {
    position: absolute;
    bottom: 30px; 
    left: 62px;
    color: #ccc;
    font-size: 20px;
    text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
  }
  /* –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è */
  .controls {
    position: fixed;
    bottom: 10px; right: 10px;
    background: rgba(0,0,0,0.85);
    color: #fff;
    padding: 12px 16px;
    border-radius: 10px;
    font-size: 14px;
    z-index: 20;
    max-width: 300px;
  }
  .controls label { display: block; margin-top: 6px; }
  .controls input {
    width: 100%; 
    padding: 6px 8px; 
    margin-top: 2px;
    border-radius: 4px; 
    border: none;
    box-sizing: border-box;
  }
  .controls button {
    margin-top: 10px; 
    background: #e64a4a; 
    color: #fff; 
    border: none;
    padding: 10px 12px; 
    border-radius: 6px; 
    cursor: pointer; 
    font-weight: 600;
    width: 100%;
  }
  .controls button:disabled {
    background: #666;
    cursor: not-allowed;
  }
  
  /* Canvas –¥–ª—è –∑–∞–ø–∏—Å–∏ - —Å–∫—Ä—ã—Ç */
  #renderCanvas {
    display: none;
  }
  
  /* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ */
  #progress {
    display: none;
    margin-top: 10px;
    padding: 8px;
    background: rgba(0,0,0,0.9);
    border-radius: 6px;
    font-size: 12px;
  }
  #progressBar {
    width: 100%;
    height: 8px;
    background: #333;
    border-radius: 4px;
    overflow: hidden;
    margin-top: 6px;
  }
  #progressFill {
    height: 100%;
    background: #e64a4a;
    width: 0%;
    transition: width 0.3s;
  }
  
  .note {
    margin-top: 8px;
    padding: 6px;
    background: rgba(40, 167, 69, 0.3);
    border-radius: 4px;
    font-size: 10px;
    line-height: 1.3;
    border: 1px solid rgba(40, 167, 69, 0.5);
  }
</style>
</head>
<body>
  <div id="captureZone">
    <div class="warning-area">
      <h1>WARNING</h1>
      <div class="sub">PROFIT WILL BE CANCELLED IN</div>
      <div class="timer" id="timer">12:00:00</div>
    </div>
    <div class="phone" id="phone">01145852502</div>
    <div class="amounts">
      THE AMOUNT TO BE PAID IS <span id="amount1">24,899</span> EGP<br>
      TO THE CONCLUSION: <span id="amount2">248,099.08</span> EGP
    </div>
    <div class="username" id="username">Yara Mohamed</div>
  </div>
  
  <div class="controls" id="controls">
    <label>‚è± –í—Ä–µ–º—è (HH:MM:SS): <input id="inputTimer" type="text" value="12:00:00"></label>
    <label>üìû –ù–æ–º–µ—Ä: <input id="inputPhone" type="text" value="01145852502"></label>
    <label>üí∞ –ü–ª–∞—Ç—ë–∂: <input id="inputAmt1" type="text" value="24,899"></label>
    <label>üìà –ü—Ä–∏–±—ã–ª—å: <input id="inputAmt2" type="text" value="248,099.08"></label>
    <label>üë§ –ò–º—è: <input id="inputName" type="text" value="Yara Mohamed"></label>
    <label>üé¨ –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (—Å–µ–∫): <input id="inputDuration" type="number" value="7" min="1" max="60"></label>
    <button onclick="applyData()">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
    <button onclick="startCountdown()">‚ñ∂ Start</button>
    <button id="recordBtn" onclick="recordVideo()">üé• –ó–∞–ø–∏—Å–∞—Ç—å –≤–∏–¥–µ–æ</button>
    
    <div id="progress">
      <div id="progressText">–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞...</div>
      <div id="progressBar"><div id="progressFill"></div></div>
    </div>
    
    <div class="note">
      ‚úÖ –í–∏–¥–µ–æ –≤ MP4 —Ñ–æ—Ä–º–∞—Ç–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ Telegram!<br>
      –ü—Ä–æ—Å—Ç–æ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ —Å–∫–∞—á–∞–Ω–Ω—ã–π —Ñ–∞–π–ª.
    </div>
  </div>
  
  <canvas id="renderCanvas"></canvas>
  
  <!-- –¢–æ–ª—å–∫–æ html2canvas -->
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  
  <script>
  let countdown = 0;
  let timerInterval = null;
  
  function pad(n){return n.toString().padStart(2,"0");}
  
  function fmt(s){
    if(s<0) s=0;
    const h=Math.floor(s/3600);
    const m=Math.floor((s%3600)/60);
    const sec=s%60;
    return `${pad(h)}:${pad(m)}:${pad(sec)}`;
  }
  
  function parseHMS(str){
    const parts=str.trim().split(":");
    if(parts.length!==3) return null;
    const[h,m,s]=parts.map(Number);
    if([h,m,s].some(n=>isNaN(n)||n<0)) return null;
    return h*3600+m*60+s;
  }
  
  function updateTimer(){
    document.getElementById("timer").textContent=fmt(countdown);
  }
  
  function startCountdown(limitSeconds=null){
    clearInterval(timerInterval);
    const total=parseHMS(document.getElementById("inputTimer").value);
    if(total===null){
      alert("–í–≤–µ–¥–∏—Ç–µ –≤—Ä–µ–º—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ HH:MM:SS");
      return;
    }
    countdown=total;
    updateTimer();
    let ticks=0;
    timerInterval=setInterval(()=>{
      countdown--;
      updateTimer();
      if(limitSeconds!==null){
        ticks++;
        if(ticks>=limitSeconds) clearInterval(timerInterval);
      }
    },1000);
  }
  
  function applyData(){
    document.getElementById("phone").textContent=document.getElementById("inputPhone").value;
    document.getElementById("amount1").textContent=document.getElementById("inputAmt1").value;
    document.getElementById("amount2").textContent=document.getElementById("inputAmt2").value;
    document.getElementById("username").textContent=document.getElementById("inputName").value;
    const val=document.getElementById("inputTimer").value.trim();
    const s=parseHMS(val);
    document.getElementById("timer").textContent=s!==null?fmt(s):val;
  }
  
  document.addEventListener("DOMContentLoaded",()=>{
    document.getElementById("inputTimer").addEventListener("input",applyData);
  });
  
  function updateProgress(text, percent) {
    const progressDiv = document.getElementById("progress");
    const progressText = document.getElementById("progressText");
    const progressFill = document.getElementById("progressFill");
    
    progressDiv.style.display = "block";
    progressText.textContent = text;
    progressFill.style.width = percent + "%";
  }
  
  function hideProgress() {
    document.getElementById("progress").style.display = "none";
  }
  
  async function recordVideo(){
    const recordBtn = document.getElementById("recordBtn");
    recordBtn.disabled = true;
    recordBtn.textContent = "‚è≥ –ó–∞–ø–∏—Å—ã–≤–∞—é...";
    
    let duration = parseInt(document.getElementById("inputDuration").value) || 7;
    duration = Math.min(Math.max(duration,1),60);
    const userName = (document.getElementById("inputName").value.trim().replace(/\s+/g,"_")) || "User";
    const total = parseHMS(document.getElementById("inputTimer").value);
    
    if(total===null){
      alert("–í–≤–µ–¥–∏—Ç–µ –≤—Ä–µ–º—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ HH:MM:SS");
      recordBtn.disabled = false;
      recordBtn.textContent = "üé• –ó–∞–ø–∏—Å–∞—Ç—å –≤–∏–¥–µ–æ";
      return;
    }
    
    countdown = total;
    updateTimer();
    
    try {
      updateProgress("–°–æ–∑–¥–∞–Ω–∏–µ —Å–Ω–∏–º–∫–∞ —ç–∫—Ä–∞–Ω–∞...", 10);
      
      // –°–æ–∑–¥–∞—ë–º snapshot –û–î–ò–ù –†–ê–ó
      const capture = document.getElementById("captureZone");
      const snapshot = await html2canvas(capture, {
        backgroundColor: '#000',
        useCORS: true,
        scale: 1,
        width: 1280,
        height: 720
      });
      
      // Canvas –¥–ª—è –∑–∞–ø–∏—Å–∏
      const canvas = document.getElementById("renderCanvas");
      canvas.width = 1280;
      canvas.height = 720;
      const ctx = canvas.getContext("2d", { alpha: false });
      
      updateProgress("–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∑–∞–ø–∏—Å–∏...", 20);
      
      // Stream —Å canvas
      const stream = canvas.captureStream(30);
      
      // –¢–∏—Ö–∞—è –∞—É–¥–∏–æ–¥–æ—Ä–æ–∂–∫–∞
      const audioCtx = new AudioContext();
      const dest = audioCtx.createMediaStreamDestination();
      const osc = audioCtx.createOscillator();
      const gain = audioCtx.createGain();
      gain.gain.value = 0.001;
      osc.connect(gain).connect(dest);
      osc.start();
      
      const combinedStream = new MediaStream([
        ...stream.getVideoTracks(),
        ...dest.stream.getAudioTracks()
      ]);
      
      // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ª—É—á—à–∏–π –¥–æ—Å—Ç—É–ø–Ω—ã–π codec
      let options = {};
      
      // –ü—Ä–æ–±—É–µ–º H.264 (–¥–∞—Å—Ç MP4-–ø–æ–¥–æ–±–Ω—ã–π —Ñ–∞–π–ª)
      if (MediaRecorder.isTypeSupported('video/webm;codecs=h264,opus')) {
        options = {
          mimeType: 'video/webm;codecs=h264,opus',
          videoBitsPerSecond: 8000000
        };
      } 
      // VP9 (–≤—ã—Å–æ–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ)
      else if (MediaRecorder.isTypeSupported('video/webm;codecs=vp9,opus')) {
        options = {
          mimeType: 'video/webm;codecs=vp9,opus',
          videoBitsPerSecond: 8000000
        };
      }
      // VP8 (–º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å)
      else {
        options = {
          mimeType: 'video/webm;codecs=vp8,opus',
          videoBitsPerSecond: 8000000
        };
      }
      
      console.log('–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è:', options.mimeType);
      
      const recorder = new MediaRecorder(combinedStream, options);
      
      const chunks = [];
      recorder.ondataavailable = e => {
        if (e.data.size > 0) chunks.push(e.data);
      };
      
      recorder.onstop = async () => {
        updateProgress("–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤–∏–¥–µ–æ...", 90);
        
        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ
        let extension = '.mp4';
        let mimeType = 'video/mp4';
        
        // –ï—Å–ª–∏ –∑–∞–ø–∏—Å–∞–ª–∏ –≤ H.264, –Ω–∞–∑—ã–≤–∞–µ–º .mp4
        if (options.mimeType && options.mimeType.includes('h264')) {
          extension = '.mp4';
          mimeType = 'video/mp4';
        } else {
          extension = '.mp4';  // –í—Å—ë —Ä–∞–≤–Ω–æ .mp4 –¥–ª—è Telegram
          mimeType = 'video/mp4';
        }
        
        const blob = new Blob(chunks, {type: mimeType});
        
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = `drift_${userName}_${duration}s${extension}`;
        a.click();
        URL.revokeObjectURL(url);
        
        updateProgress("‚úÖ –ì–æ—Ç–æ–≤–æ! –û—Ç–ø—Ä–∞–≤—å—Ç–µ —Ñ–∞–π–ª –≤ Telegram", 100);
        setTimeout(hideProgress, 3000);
        
        recordBtn.disabled = false;
        recordBtn.textContent = "üé• –ó–∞–ø–∏—Å–∞—Ç—å –≤–∏–¥–µ–æ";
        osc.stop();
        audioCtx.close();
      };
      
      // –ó–ê–ü–£–°–ö –ó–ê–ü–ò–°–ò
      recorder.start(100);
      updateProgress("–ó–∞–ø–∏—Å—å –≤–∏–¥–µ–æ...", 30);
      
      startCountdown(duration);
      
      const startTime = Date.now();
      const endTime = startTime + duration * 1000;
      
      // –†–µ–Ω–¥–µ—Ä –∫–∞–¥—Ä–æ–≤ —Å —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–º FPS
      function renderFrame() {
        const now = Date.now();
        const elapsed = now - startTime;
        
        // –ü–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞
        ctx.fillStyle = '#000';
        ctx.fillRect(0, 0, 1280, 720);
        
        // –†–∏—Å—É–µ–º –±–∞–∑—É
        ctx.drawImage(snapshot, 0, 0, 1280, 720);
        
        // –ü–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º —Ç–∞–π–º–µ—Ä
        ctx.font = 'bold 80px "Kdam Thmor", sans-serif';
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';
        
        // –¢–µ–Ω—å
        ctx.shadowColor = 'rgba(0, 0, 0, 0.9)';
        ctx.shadowBlur = 6;
        ctx.shadowOffsetX = 3;
        ctx.shadowOffsetY = 3;
        
        // –¢–∞–π–º–µ—Ä
        ctx.fillStyle = '#e64a4a';
        ctx.fillText(fmt(countdown), 640, 310);
        
        // –°–±—Ä–æ—Å —Ç–µ–Ω–∏
        ctx.shadowColor = 'transparent';
        ctx.shadowBlur = 0;
        ctx.shadowOffsetX = 0;
        ctx.shadowOffsetY = 0;
        
        const percent = Math.min((elapsed / (duration * 1000)) * 55, 55);
        updateProgress(`–ó–∞–ø–∏—Å—å: ${Math.round(elapsed/1000)}/${duration}—Å`, 30 + percent);
        
        if (now < endTime) {
          requestAnimationFrame(renderFrame);
        } else {
          setTimeout(() => recorder.stop(), 300);
        }
      }
      
      renderFrame();
      
    } catch (error) {
      console.error("–û—à–∏–±–∫–∞:", error);
      hideProgress();
      alert("–û—à–∏–±–∫–∞ –∑–∞–ø–∏—Å–∏: " + error.message);
      recordBtn.disabled = false;
      recordBtn.textContent = "üé• –ó–∞–ø–∏—Å–∞—Ç—å –≤–∏–¥–µ–æ";
    }
  }
  
  window.recordVideo = recordVideo;
  window.applyData = applyData;
  window.startCountdown = startCountdown;
  </script>
</body>
</html>
