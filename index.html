<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Drift Countdown Animation</title>

<link href="https://fonts.googleapis.com/css?family=Kdam+Thmor&display=swap" rel="stylesheet">

<style>
  html, body {
    height: 100%;
    width: 100%;
    margin: 0;
    background: #000;
    display: flex;
    justify-content: center;
    align-items: center;
    overflow: hidden;
    font-family: "Kdam Thmor", system-ui, sans-serif;
  }

  #captureZone {
    position: relative;
    width: 1280px;
    height: 629px;
    background: url("background.jpg") center/cover no-repeat;
    transform-origin: top center;
  }

  @media (min-aspect-ratio: 1280/629) {
    #captureZone { transform: scale(calc(100vh / 629)); }
  }
  @media (max-aspect-ratio: 1280/629) {
    #captureZone { transform: scale(calc(100vw / 1280)); }
  }

  .warning-area {
    position: absolute;
    top: 100px; left: 415px;
    width: 600px; text-align: center;
    color: white;
  }
  .warning-area h1 {
    color: #e64a4a;
    font-size: 58px;
    margin-bottom: 2px;
  }
  .warning-area .sub {
    font-size: 40px;
    margin-bottom: 2px;
  }
  .timer {
    font-size: 58px;
    font-weight: 400;
    color: #e64a4a;
  }

  .phone {
    position: absolute;
    top: 441px; left: 625px;
    font-size: 24px; font-weight: 400;
    color: black;
    letter-spacing: 1px;
  }

  .amounts {
    position: absolute;
    top: 520px;
    left: 56%;
    transform: translateX(-50%);
    width: auto;
    font-size: 24px;
    color: white;
    text-align: center;
    white-space: nowrap;
  }

  .username {
    position: absolute;
    bottom: 20px; left: 62px;
    color: #ccc;
    font-size: 18px;
  }

  .controls {
    position: fixed;
    bottom: 10px; right: 10px;
    background: rgba(0,0,0,0.6);
    color: #fff;
    padding: 12px 16px;
    border-radius: 10px;
    font-size: 14px;
    z-index: 20;
  }
  .controls label { display: block; margin-top: 6px; }
  .controls input {
    width: 200px; padding: 4px 6px; margin-top: 2px;
    border-radius: 4px; border: none;
  }
  .controls button {
    margin-top: 10px; background: #e64a4a; color: #fff; border: none;
    padding: 8px 10px; border-radius: 6px; cursor: pointer; font-weight: 400;
  }

  #canvasRecorder { display: none; }
</style>
</head>
<body>
  <div id="captureZone">
    <div class="warning-area">
      <h1>WARNING</h1>
      <div class="sub">PROFIT WILL BE CANCELLED IN</div>
      <div class="timer" id="timer">12:00:00</div>
    </div>

    <div class="phone" id="phone">01145852502</div>

    <div class="amounts">
      THE AMOUNT TO BE PAID IS <span id="amount1">24,899</span> EGP<br>
      TO THE CONCLUSION: <span id="amount2">248,099.08</span> EGP
    </div>

    <div class="username" id="username">Yara Mohamed</div>
  </div>

  <div class="controls" id="controls">
    <label>‚è± –í—Ä–µ–º—è –Ω–∞—á–∞–ª–∞ (HH:MM:SS): <input id="inputTimer" type="text" value="12:00:00"></label>
    <label>üìû –ù–æ–º–µ—Ä: <input id="inputPhone" type="text" value="01145852502"></label>
    <label>üí∞ –°—É–º–º–∞ –ø–ª–∞—Ç–µ–∂–∞: <input id="inputAmt1" type="text" value="24,899"></label>
    <label>üìà –°—É–º–º–∞ –ø—Ä–∏–±—ã–ª–∏: <input id="inputAmt2" type="text" value="248,099.08"></label>
    <label>üë§ –ò–º—è: <input id="inputName" type="text" value="Yara Mohamed"></label>
    <label>üé¨ –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤–∏–¥–µ–æ (—Å–µ–∫): <input id="inputDuration" type="number" value="7" min="1" max="60"></label>
    <button onclick="applyData()">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
    <button onclick="startCountdown()">Start</button>
    <button onclick="recordVideo()">üé• –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤–∏–¥–µ–æ</button>
  </div>

  <canvas id="canvasRecorder"></canvas>

<!-- –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ -->
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<script src="https://unpkg.com/@ffmpeg/ffmpeg@0.12.6/dist/ffmpeg.min.js"></script>

<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

<script>
let countdown = 0;
let timerInterval = null;

function pad(n){return n.toString().padStart(2,"0");}
function fmt(s){if (s<0) s=0; const h=Math.floor(s/3600), m=Math.floor((s%3600)/60), sec=s%60; return `${pad(h)}:${pad(m)}:${pad(sec)}`;}
function parseHMS(str){
  const parts = str.trim().split(":"); if (parts.length!==3) return null;
  const [h,m,s]=parts.map(Number); if ([h,m,s].some(n=>isNaN(n)||n<0)) return null;
  return h*3600+m*60+s;
}
function updateTimer(){document.getElementById("timer").textContent=fmt(countdown);}
function startCountdown(limitSeconds=null){
  clearInterval(timerInterval);
  const total=parseHMS(document.getElementById("inputTimer").value);
  if(total===null){alert("–í–≤–µ–¥–∏—Ç–µ –≤—Ä–µ–º—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ HH:MM:SS, –Ω–∞–ø—Ä–∏–º–µ—Ä 12:00:00");return;}
  countdown=total; updateTimer();
  let ticks=0;
  timerInterval=setInterval(()=>{
    countdown--; updateTimer();
    if(limitSeconds!==null){ticks++; if(ticks>=limitSeconds) clearInterval(timerInterval);}
  },1000);
}
function applyData(){
  document.getElementById("phone").textContent=document.getElementById("inputPhone").value;
  document.getElementById("amount1").textContent=document.getElementById("inputAmt1").value;
  document.getElementById("amount2").textContent=document.getElementById("inputAmt2").value;
  document.getElementById("username").textContent=document.getElementById("inputName").value;
  const val=document.getElementById("inputTimer").value.trim();
  const s=parseHMS(val);
  document.getElementById("timer").textContent=s!==null?fmt(s):val;
}

document.addEventListener("DOMContentLoaded",()=>{
  document.getElementById("inputTimer").addEventListener("input",applyData);
});

async function recordVideo(){
  const capture=document.getElementById("captureZone");
  const controls=document.getElementById("controls");
  controls.style.display="none";

  let duration=parseInt(document.getElementById("inputDuration").value)||7;
  duration=Math.min(Math.max(duration,1),60);

  const userName=(document.getElementById("inputName").value.trim().replace(/\s+/g,"_"))||"User";
  const total=parseHMS(document.getElementById("inputTimer").value);
  if(total===null){alert("–í–≤–µ–¥–∏—Ç–µ –≤—Ä–µ–º—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ HH:MM:SS, –Ω–∞–ø—Ä–∏–º–µ—Ä 12:00:00");controls.style.display="block";return;}
  countdown=total; updateTimer();

  await new Promise(r=>setTimeout(r,300));

  const canvas=document.getElementById("canvasRecorder");
  canvas.width=1280; canvas.height=629;
  const ctx=canvas.getContext("2d");
  const stream=canvas.captureStream(30);

  // üéß –¥–æ–±–∞–≤–ª—è–µ–º ‚Äú—Ç–∏—à–∏–Ω—É‚Äù
  const audioCtx=new AudioContext();
  const dest=audioCtx.createMediaStreamDestination();
  const osc=audioCtx.createOscillator();
  const gain=audioCtx.createGain();
  gain.gain.value=0;
  osc.connect(gain).connect(dest);
  osc.start();

  const combinedStream=new MediaStream([...stream.getTracks(), ...dest.stream.getTracks()]);
  const recorder=new MediaRecorder(combinedStream,{mimeType:"video/webm;codecs=vp9,opus"});
  const chunks=[];
  recorder.ondataavailable=e=>chunks.push(e.data);
  recorder.onstop=()=>{
    const blob=new Blob(chunks,{type:"video/webm"});
    const url=URL.createObjectURL(blob);
    const a=document.createElement("a");
    a.href=url;
    // ‚ö†Ô∏è —Å–æ—Ö—Ä–∞–Ω—è–µ–º –∫–∞–∫ .mp4 (–º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä—ã –≤–∏–¥—è—Ç –∫–∞–∫ –≤–∏–¥–µ–æ)
    a.download=`drift_countdown_${userName}_${duration}s.mp4`;
    a.click();
    URL.revokeObjectURL(url);
    controls.style.display="block";
  };

  await html2canvas(capture,{backgroundColor:null,useCORS:true});
  recorder.start();
  startCountdown(duration);

  const endTime=Date.now()+duration*1000;
  (function drawFrame(){
    html2canvas(capture,{backgroundColor:null,useCORS:true,scale:1})
      .then(cnv=>{
        ctx.clearRect(0,0,canvas.width,canvas.height);
        ctx.drawImage(cnv,0,0,canvas.width,canvas.height);
      });
    if(Date.now()<endTime) requestAnimationFrame(drawFrame);
    else setTimeout(()=>recorder.stop(),300);
  })();
}
</script>

</body>
</html>

